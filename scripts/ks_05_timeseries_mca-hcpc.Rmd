---
title: "ks_mca-hcpc_timeseries"
author: "Kate Sheridan"
date: "3/13/2022"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
library(tidyverse)
library(ggplot2)
library(FactoMineR)
library(factoextra)
library(dplyr)
library(here)

# here filepaths
traits <- here('data', 'clean')
plots <- here('output', '2022march', 'mca')
```

## load in data

```{r}
# time series
algae_traits <- read_csv(here(traits, "20220321_1982-end_algae.csv")) %>%
  filter(intertidal == 'yes') %>%
  select(!(c(intertidal, group, size_categories, feeding, 
             saccate_external_morphology,
             #potential_asexual_reproduction,
             epilithic_use_space,
             epiphytic_env_position, epizoic_env_position,
             macroalgae)))

animal_traits <- read_csv(here(traits, "20220321_1982-end_animal.csv")) %>%
  filter(intertidal == 'yes') %>%
  select(!(c(intertidal, trophic_level, pelagic, deposit_feeder)))

# to load in individual species lists from parts of the time series
#animal_1982_1995_traits <- read_csv(here(mcadata, "20220313_1982-1995_animal.csv")) %>%
#  filter(intertidal == 'yes') %>%
#  select(!(c(intertidal)))
#animal_2011_end_traits <- read_csv(here(mcadata, "20220313_2011-end_animal.csv")) %>%
#  filter(intertidal == 'yes') %>%
#  select(!(c(intertidal)))


# all species
algae_imputed_all <- read_csv(here(traits, "20220323_algae_imputed.csv"),
                                 col_select = !1) %>%
  filter(intertidal == 'yes') %>%
  select(!(c(intertidal)))

#animal_imputed_all <- read_csv(here(traits, "20220321_animal_imputed.csv"),
#                                 col_select = !1) %>%
#  filter(intertidal == 'yes') %>%
#  select(!(c(intertidal)))
```

## load in functions

```{r}
# input should be imputed traits, filtered as needed
## note that we're selecting columns automatically here 
## starting with column 3 after the species column; change if not true
# note that only output starting with gg are ggplot objects
appledoreMCAHCPC <- function(traits) {
  # select columns for MCA
  traits <- traits %>% 
    column_to_rownames('species') %>%
    dplyr::select(3:(ncol(traits)-1)) %>%
    mutate(across(.fns = ~ as.factor(.)))
  # run MCA
  mca2 <- MCA(traits, graph = FALSE)
  # extract variable categories
  mca2_vars <- get_mca_var(mca2)
  # prepare data for plotting
  cats=apply(traits, 2, function(x) nlevels(as.factor(x)))
  mca2_vars_df = data.frame(mca2$var$coord, Variable = rep(names(cats), 
                                                         cats))
  mca2_obs_df = data.frame(mca2$ind$coord)
  # plot with lines and vectors
  mcaggplot <- ggplot(data = mca2_obs_df, aes(x = Dim.1, y = Dim.2)) + 
    geom_hline(yintercept = 0, colour = "gray70") + 
    geom_vline(xintercept = 0, colour = "gray70") + 
    geom_point(colour = "gray50", alpha = 0.7) + 
    geom_density2d(colour = "gray80") + 
    geom_text(data = mca2_vars_df, aes(x = Dim.1, y = Dim.2, 
                                     label = rownames(mca2_vars_df), 
                                     colour = Variable)) + 
    ggtitle("MCA plot with FactorMineR") + 
    scale_colour_discrete(name = "Variable") +
    geom_segment(data = mca2_vars_df, aes(x = 0, y = 0, xend = Dim.1, yend = Dim.2), 
               arrow = arrow(length = unit(0.2, "cm")), colour = "black") +
    theme_bw(20)+ xlab ("Dim 1 21.28 %")+ ylab("Dim 2 17.54%")
  # ellipses plot
  plot_ellipses <- plotellipses(mca2)
  # diagnostics
  scree2 <- fviz_screeplot(mca2)
  contrib2 <- fviz_contrib(mca2, choice = "var", axes = 1:2, top = 15)
  cos2plot <- fviz_cos2(mca2, choice = 'var', axes = 1:2, top = 15)
  # this plot combines output of contribution and cos2, 
  ## eg: orange+high alpha = high contribution, high quality
  cos2contribplot <- fviz_mca_var(mca2, col.var = 'cos2', alpha.var = 'contrib',
                           gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"), 
                           repel = TRUE, # Avoid text overlapping
                           ggtheme = theme_minimal())
  
  
  # run HCPC
  hcpc2 <- HCPC(mca2, graph = FALSE)
  # hcpc dendrogram
  hcpc_dend <- fviz_dend(hcpc2, cex = .6)
  # hcpc factor map
  hcpc_clust <- fviz_cluster(hcpc2, geom = "point", main = "Factor map")
  
  
  #output
  list(mcares = mca2, mcacos2 = mca2_vars$cos2,
       clustmembers = hcpc2$desc.ind$para,
       clustervariables = hcpc2$desc.var$category,
       hcpc_chi = hcpc2$desc.var$test.chi2,
       ggmca = mcaggplot,
       ggscreeplot = scree2, ggcontrib = contrib2,
       ggcos2 = cos2plot, ggvars = cos2contribplot,
       ellipses = plot_ellipses, ggdendrogram = hcpc_dend,
       ggclusterplot = hcpc_clust)
}
```

## run function example

explore output; use df\$ to see all saved plots and summary stats Any
output starting with gg is a ggplot object and can be chained with
ggplot functions such as: `algae_all$ggmca + theme_bw()`

```{r function-explore}
algae_all_test <- algae_traits %>%
  select(!(c(year, transect, position))) %>%
  distinct()

algae_all <- appledoreMCAHCPC(algae_all_test)
# example view a summary
algae_all$mcares$eig
# example ggplot
algae_all$ggscreeplot + theme_bw()

algae_all$ggmca


algae_all$ggdendrogram
algae_all$ggclusterplot

algae_all$clustervariables
algae_all$clustmembers

```

# set up subsets and run

## Algae

```{r algae-all}
algaehcpc <- HCPC(algae_all$mcares, nb.clust = 5)

algaehcpc$desc.var
algaehcpc$desc.ind

fviz_dend(algaehcpc)

```

### Timeseries

```{r algae-timeseries}
# filter
algae_82_95 <- algae_traits %>%
  filter(year <= 1994 & year >= 1982) %>%
  select(!(c(year, transect, position))) %>%
  distinct()

algae_96_06 <- algae_traits %>%
  filter(year >= 1996 & year < 2007) %>%
  select(!(c(year, transect, position))) %>%
  distinct()

algae_10_end <- algae_traits %>%
  filter(year <= 2011) %>%
  select(!(c(year, transect, position))) %>%
  distinct()

# run mca
mca_algae_82_95 <- appledoreMCAHCPC(algae_82_95)
mca_algae_96_06 <- appledoreMCAHCPC(algae_96_06)
mca_algae_10_end <- appledoreMCAHCPC(algae_10_end)
```

```{r algae-timeseries-explore}
mca_algae_82_95$ggmca
mca_algae_96_06$ggmca
mca_algae_10_end$ggmca
```

### exposed/sheltered

for the time series here it will just be beginning and end

```{r algae-exposedsheltered}
# just exposed v sheltered
algae_exposed <- algae_traits %>%
  filter(position == 'exposed') %>%
  select(!(c(year, transect, position))) %>%
  distinct()

algae_sheltered <- algae_traits %>%
  filter(position == 'sheltered') %>%
  select(!(c(year, transect, position))) %>%
  distinct()

mca_algae_exposed <- appledoreMCAHCPC(algae_exposed)
mca_algae_sheltered <- appledoreMCAHCPC(algae_sheltered)

# exposed v sheltered beginning and end
algae_exposed_start <- algae_traits %>%
  filter(position == 'exposed' & year <= 1994 & year >= 1982) %>%
  select(!(c(year, transect, position))) %>%
  distinct()

algae_sheltered_start <- algae_traits %>%
  filter(position == 'sheltered' & year <= 1994 & year >= 1982) %>%
  select(!(c(year, transect, position))) %>%
  distinct()

algae_exposed_end <- algae_traits %>%
  filter(position == 'exposed' & year <= 2010) %>%
  select(!(c(year, transect, position))) %>%
  distinct()

algae_sheltered_end <- algae_traits %>%
  filter(position == 'sheltered' & year <= 2010) %>%
  select(!(c(year, transect, position))) %>%
  distinct()

mca_algae_exposed_start <- appledoreMCAHCPC(algae_exposed_start)
mca_algae_sheltered_start <- appledoreMCAHCPC(algae_sheltered_start)
mca_algae_exposed_end <- appledoreMCAHCPC(algae_exposed_end)
mca_algae_sheltered_end <- appledoreMCAHCPC(algae_sheltered_end)
```

```{r algae-position-plots}

mca_algae_exposed_start$ggmca
mca_algae_exposed_end$ggmca
mca_algae_sheltered_start$ggmca
mca_algae_sheltered_end$ggmca
mca_algae_exposed$ggmca
mca_algae_sheltered$ggmca

ggsave(here(plots, 'temporary', '2algaeexposed.png'), mca_algae_exposed$ggmca, width = 10)
ggsave(here(plots, 'temporary', '2algaesheltered.png'), mca_algae_sheltered$ggmca, width = 10)

ggsave(here(plots, 'temporary', '2algaeexposed_start.png'), mca_algae_exposed_start$ggmca, width = 10)
ggsave(here(plots, 'temporary', '2algaeexposed_end.png'), mca_algae_exposed_end$ggmca, width = 10)

ggsave(here(plots, 'temporary', '2algaesheltered_start.png'), mca_algae_sheltered_start$ggmca, width = 10)
ggsave(here(plots, 'temporary', '2algaesheltered_end.png'), mca_algae_sheltered_end$ggmca, width = 10)

```

```{r algae-exposedsheltered-explore}


mca_algae_exposed$ggdendrogram
mca_algae_sheltered$ggdendrogram

mca_algae_exposed_start$ggdendrogram
mca_algae_exposed_end$ggdendrogram

mca_algae_sheltered_start$ggdendrogram
mca_algae_sheltered_end$ggdendrogram

mca_algae_sheltered_end$clustmembers
mca_algae_sheltered_end$clustervariables

mca_algae_sheltered_start$clustmembers
mca_algae_sheltered_start$clustervariables


exposedhcpc2 <- HCPC(res = mca_algae_exposed_end$mcares, nb.clust =  5)
mca_algae_exposed_start$ggdendrogram
fviz_dend(exposedhcpc2)







```

```{r algae-exposedsheltered-summarystats}
mca_algae_exposed_start$mcares$eig
mca_algae_exposed_end$mcares$eig
mca_algae_sheltered_start$mcares$eig
mca_algae_sheltered_end$mcares$eig


mca_algae_exposed_start$ggcos2
mca_algae_exposed_end$ggcos2
mca_algae_sheltered_start$ggcos2
mca_algae_sheltered_end$ggcos2


mca_algae_exposed_start$mcares$var$contrib


mca_algae_exposed_start$ggcontrib
mca_algae_exposed_end$ggcontrib
mca_algae_sheltered_start$ggcontrib
mca_algae_sheltered_end$ggcontrib
```

```{r algae-compare}
library(arsenal)
# in output, first dataframe is X, second is Y
exposedvprotect <- comparedf(algae_exposed, algae_sheltered, by = 'species')
#extract differences
diffs(exposedvprotect, what = c('observations'))

protectstvend <- comparedf(algae_sheltered_start, algae_sheltered_end, by = 'species')
diffs(protectstvend, what = c('observations'))

exposedstvend <- comparedf(algae_exposed_start, algae_exposed_end, by = 'species')
diffs(exposedstvend, what = c('observations'))

```

## Animals

Note animal_all gives different result than any group of animals. I
really don't understand why, it puts Astarias rubens in totally
different locations.

```{r animal-all}
animal_all_t <- animal_traits %>%
  select(!(c(year,transect,position))) %>%
  distinct()

mca_animal_all <- appledoreMCAHCPC(animal_all_t)

animal_allhcpc <- HCPC(res = mca_animal_all$mcares, nb.clust =  5)

# plots testing output
fviz_cluster(animal_allhcpc, geom = "point", main = "Factor map")
mca_animal_all$ggclusterplot
fviz_dend(animal_allhcpc)
mca_animal_all$clustmembers
mca_animal_all$clustervariables
```

### Timeseries

```{r animal-timeseries}
# filter
animal_82_95 <- animal_traits %>%
  filter(year <= 1994 & year >= 1982) %>%
  select(!(c(year, transect, position))) %>%
  distinct()

animal_96_06 <- animal_traits %>%
  filter(year >= 1996 & year < 2007) %>%
  select(!(c(year, transect, position))) %>%
  distinct()

animal_10_end <- animal_traits %>%
  filter(year <= 2011) %>%
  select(!(c(year, transect, position))) %>%
  distinct()

# run mca
mca_animal_82_95 <- appledoreMCAHCPC(animal_82_95)
mca_animal_96_06_mca <- appledoreMCAHCPC(animal_96_06)
mca_animal_10_end <- appledoreMCAHCPC(animal_10_end)
```

### exposed/sheltered

for the time series here it will just be beginning and end

```{r animal-exposedsheltered}
# just exposed v sheltered
animal_exposed <- animal_traits %>%
  filter(position == 'exposed') %>%
  select(!(c(year, transect, position))) %>%
  distinct()

animal_sheltered <- animal_traits %>%
  filter(position == 'sheltered') %>%
  select(!(c(year, transect, position))) %>%
  distinct()

mca_animal_exposed <- appledoreMCAHCPC(animal_exposed)
mca_animal_sheltered <- appledoreMCAHCPC(animal_sheltered)

# exposed v sheltered beginning and end
animal_exposed_start <- animal_traits %>%
  filter(position == 'exposed' & year <= 1994 & year >= 1982) %>%
  select(!(c(year, transect, position))) %>%
  distinct()

animal_sheltered_start <- animal_traits %>%
  filter(position == 'sheltered' & year <= 1994 & year >= 1982) %>%
  select(!(c(year, transect, position))) %>%
  distinct()

animal_exposed_end <- animal_traits %>%
  filter(position == 'exposed' & year <= 2010) %>%
  select(!(c(year, transect, position))) %>%
  distinct()

animal_sheltered_end <- animal_traits %>%
  filter(position == 'sheltered' & year <= 2010) %>%
  select(!(c(year, transect, position))) %>%
  distinct()

mca_animal_exposed_start <- appledoreMCAHCPC(animal_exposed_start)
mca_animal_sheltered_start <- appledoreMCAHCPC(animal_sheltered_start)
mca_animal_exposed_end <- appledoreMCAHCPC(animal_exposed_end)
mca_animal_sheltered_end <- appledoreMCAHCPC(animal_sheltered_end)
```

```{r animal-position-plots}
# overall
mca_animal_exposed$ggmca
mca_animal_sheltered$ggmca


mca_animal_exposed_start$ggvars
mca_animal_exposed_end$ggvars


# exposed
mca_animal_exposed_start$ggmca
mca_animal_exposed_end$ggmca


# sheltered
mca_animal_sheltered_start$ggmca
mca_animal_sheltered_end$ggmca

mca_animal_sheltered_start$ggvars
mca_animal_sheltered_end$ggvars

ggsave(here(plots, 'temporary', 'animalexposed_start.png'), mca_animal_exposed_start$ggmca, width = 10)
ggsave(here(plots, 'temporary', 'animalexposed_end.png'), mca_animal_exposed_end$ggmca, width = 10)

ggsave(here(plots, 'temporary', 'animalsheltered_start.png'), mca_animal_sheltered_start$ggmca, width = 10)
ggsave(here(plots, 'temporary', 'animalsheltered_end.png'), mca_animal_sheltered_end$ggmca, width = 10)

```

```{r animal-hcpc-exploration}
shelteredhcpc2 <- HCPC(res = mca_animal_sheltered$mcares, nb.clust =  5)
exposedhcpc2 <- HCPC(res = mca_animal_exposed$mcares, nb.clust =  4)
  
fviz_cluster(exposedhcpc2, geom = "point", main = "Factor map") 
fviz_cluster(shelteredhcpc2, geom = "point", main = "Factor map")

fviz_dend(exposedhcpc2)
fviz_dend(shelteredhcpc2)

mca_animal_exposed$ggclusterplot
mca_animal_sheltered$ggclusterplot

mca_animal_exposed$ggdendrogram
mca_animal_sheltered$ggdendrogram

mca_animal_exposed$clustervariables
mca_animal_sheltered$clustervariables

#mca_animal_exposed$clustmembers
mca_animal_sheltered$clustmembers

mca_animal_sheltered_start$ggclusterplot
mca_animal_sheltered_end$ggclusterplot
mca_animal_exposed_start$ggclusterplot
mca_animal_exposed_end$ggclusterplot

mca_animal_sheltered$ggdendrogram
mca_animal_sheltered_start$ggdendrogram
mca_animal_sheltered_end$ggdendrogram

mca_animal_exposed$ggdendrogram
mca_animal_exposed_start$ggdendrogram
mca_animal_exposed_end$ggdendrogram
```

# arsenal to extract differences quickly

```{r animal-compare}
library(arsenal)
# in output, first dataframe is X, second is Y
exposedvprotect <- comparedf(animal_exposed, animal_sheltered, by = 'species')
#extract differences
diffs(exposedvprotect, what = c('observations'))

protectstvend <- comparedf(animal_sheltered_start, animal_sheltered_end, by = 'species')
diffs(protectstvend, what = c('observations'))

exposedstvend <- comparedf(animal_exposed_start, animal_exposed_end, by = 'species')
diffs(exposedstvend, what = c('observations'))

```

# presentation plots

palette is:
`#bcbcd2, #94b4d8, #5484c4, #374658, #a08b5a, #806238, #543414, #3a230e`
lavender grey, pale cerulean, glaucous, charcoal, metallic sunburst,
coyote brown, dark brown, bistre

sets of 2 should be primarily drawn from the middle two of each part of
the palette: two blues #94b4d8, #5484c4 two browns #806238, #543414 blue
brown light #94b4d8,#806238 blue brown dark #5484c4, #543414

## clusters

```{r testing}
#tree
library(dendextend)

# extract dendrogram and save as ggdend object
test <- as.ggdend(mca_animal_exposed$ggdendrogram$plot_env$dend)

ggplot(test, horiz = TRUE) + 
  labs(y = NULL, title = 'Algae Clusters') +
  ylim(.25,-.12) +
  # manually set colors
  scale_color_manual(values = c('red','blue','purple','black','green','orange','grey')) +
  theme(axis.ticks = element_blank(),
        axis.text.y = element_blank()
        )

ggsave(filename = here(plots, 'algaetest.png'), device = 'png', 
       height = 5, width = 7, units = 'in')



# clusters

mca_algae_exposed_start$ggclusterplot +
  #manually set colors
  scale_fill_manual(values = c('red','blue','purple','black','green','orange')) +
  scale_color_manual(values = c('red','blue','purple','black','green','orange')) +
  labs(title = 'Algae clusters') +
  theme_classic() +
  theme(axis.text = element_blank())

ggsave(filename = here(plots, 'algaetest2.png'), device = 'png', 
       height = 5, width = 7, units = 'in')


#mcas
mca_animal_exposed_start$ggmca + 
  labs(title = 'Algae mca') +
    scale_color_manual(values = c('red','blue','purple', 'black',
                                  'green','orange', 'grey', 'yellow', 'brown',
                                  'grey17', 'pink', 'grey60', 'salmon',
                                  'violet', 'cornsilk2')) +
  theme_classic() +
  theme(legend.position = 'none')
  
  



  
ggsave(filename = here(plots, 'algaetest3.png'), device = 'png', 
       height = 5, width = 7, units = 'in')

```

```{r algae}
library(dendextend)
algaehcpc_dend <- fviz_dend(algaehcpc, cex = .6)
algaehcpc_dend <- as.ggdend(algaehcpc_dend$plot_env$dend)
algaehcpc_cluster <- fviz_cluster(algaehcpc, geom = "point", main = "Factor map")


ggplot(algaehcpc_dend, horiz = TRUE) + 
  labs(y = NULL, title = 'Algae Functional Groups: All') +
  ylim(.25,-.12) +
  # manually set colors
  scale_color_manual(values = c('#bcbcd2','#5484c4','#543414','#374658', '#a08b5a', 'black')) +
  theme(axis.ticks = element_blank(),
        axis.text.y = element_blank()
        )

#ggsave(filename = here(plots, 'hcpc', '20220323_algae_dend.png'), device = 'png', 
#       height = 5, width = 7, units = 'in')

algaehcpc_cluster$data


algaehcpc_cluster +
  #manually set colors
  scale_fill_manual(values = c('#543414', '#a08b5a','#5484c4', '#bcbcd2','#374658')) +
  scale_color_manual(values = c('#543414','#a08b5a','#5484c4', '#bcbcd2','#374658')) +
  labs(title = 'Algae functional groups: All') +
  theme_classic() +
  theme(axis.text = element_blank(),
        legend.position = 'none')

ggsave(filename = here(plots, 'hcpc', '20220323_algae_all_cluster.png'), device = 'png', 
       height = 5, width = 7, units = 'in')

```



```{r animal-all}
animal_allhcpc <- HCPC(res = mca_animal_all$mcares, nb.clust =  5)
animal_hcpc_dend <- fviz_dend(animal_allhcpc, cex = .6)
animal_hcpc_dend <- as.ggdend(animal_hcpc_dend$plot_env$dend)
animalhcpc_cluster <- fviz_cluster(animal_allhcpc, geom = "point", main = "Factor map")

ggplot(animal_hcpc_dend, horiz = TRUE) + 
  labs(y = NULL, title = 'Animal Functional groups: All') +
  ylim(.29,-.12) +
  # manually set colors
  scale_color_manual(values = c('#5484c4','#bcbcd2','#543414','#374658', '#a08b5a', 'black')) +
  theme(axis.ticks = element_blank(),
        axis.text.y = element_blank()
        )

#ggsave(filename = here(plots, 'hcpc', '20220323_animal_dend_all.png'), device = 'png', 
#       height = 5, width = 7, units = 'in')

animalhcpc_cluster$data

animalhcpc_cluster +
  #manually set colors
  scale_fill_manual(values = c('#374658', '#5484c4', '#bcbcd2','#a08b5a', '#543414')) +
  scale_color_manual(values = c('#374658','#5484c4', '#bcbcd2', '#a08b5a', '#543414')) +
  labs(title = 'Animal functional groups: All') +
  theme_classic() +
  theme(axis.text = element_blank(),
        legend.position = 'none')


ggsave(filename = here(plots, 'hcpc', '20220323_animal_all_cluster.png'), device = 'png', 
       height = 5, width = 7, units = 'in')
```



```{r animals}
#manually split the 4 clusters for sheltered_start
## probably better plotting can be done at this point but 
# i'm just going to make it into the same format as the others
shelteredhcpc2 <- HCPC(res = mca_animal_sheltered_start$mcares, nb.clust =  5)
start_test <- fviz_dend(shelteredhcpc2, cex = .7)
start_test2 <- as.ggdend(start_test$plot_env$dend)
start_cluster2 <- fviz_cluster(shelteredhcpc2, geom = "point", main = "Factor map")


shelteredhcpc3 <- HCPC(res = mca_animal_sheltered_end$mcares, nb.clust =  5)
end_test <- fviz_dend(shelteredhcpc3, cex = .7)
end_test2 <- as.ggdend(end_test$plot_env$dend)


#dend_animal_sheltered_end <- as.ggdend(mca_animal_sheltered_end$ggdendrogram$plot_env$dend)


ggplot(start_test2, horiz = TRUE) + 
  labs(y = NULL, title = 'Animal Functional groups: Protected 1982-1995') +
  ylim(.25,-.12) +
  # manually set colors
  scale_color_manual(values = c('#5484c4','#bcbcd2','#543414','#374658', '#a08b5a', 'black')) +
  theme(axis.ticks = element_blank(),
        axis.text.y = element_blank()
        )

#ggsave(filename = here(plots, 'hcpc', '20220321_animal_dend_protected-start.png'), device = 'png', 
#       height = 5, width = 7, units = 'in')


ggplot(end_test2, horiz = TRUE) + 
  labs(y = NULL, title = 'Animal functional groups: protected 2010-present') +
  ylim(.3,-.12) +
  # manually set colors
  scale_color_manual(values = c('#a08b5a','#543414','#bcbcd2','#5484c4', '#374658', 'black')) +
  theme(axis.ticks = element_blank(),
        axis.text.y = element_blank()
        )

ggsave(filename = here(plots, 'hcpc', '20220321_animal_protected-end_dend.png'), device = 'png', 
       height = 5, width = 7, units = 'in')



start_cluster2 +
  #manually set colors
  scale_fill_manual(values = c('#543414', '#a08b5a', '#5484c4', '#bcbcd2')) +
  scale_color_manual(values = c('#543414', '#a08b5a', '#5484c4', '#bcbcd2')) +
  labs(title = 'Animal functional groups: protected 1982-1995') +
  theme_classic() +
  theme(axis.text = element_blank(),
        legend.position = 'none')

ggsave(filename = here(plots, 'hcpc', '20220321_animal_protected-start_cluster.png'), device = 'png', 
       height = 5, width = 7, units = 'in')

mca_animal_sheltered_end$ggclusterplot +
  #manually set colors
  scale_fill_manual(values = c('#a08b5a','#543414','#bcbcd2')) +
  scale_color_manual(values = c('#a08b5a','#543414','#bcbcd2')) +
  labs(title = 'Animal functional groups: protected 2010-present') +
  theme_classic() +
  theme(axis.text = element_blank(),
        legend.position = 'none')

ggsave(filename = here(plots, 'hcpc', '20220321_animal_protected-end_cluster.png'), device = 'png', 
       height = 5, width = 7, units = 'in')





dend_animal_exposed <- as.ggdend(mca_animal_exposed_end$ggdendrogram$plot_env$dend)

ggplot(dend_animal_exposed, horiz = TRUE) + 
  labs(y = NULL, title = 'Animal functional groups: exposed 2010-present') +
  ylim(.3,-.12) +
  # manually set colors
  scale_color_manual(values = c('#a08b5a','#543414','#bcbcd2','black')) +
  theme(axis.ticks = element_blank(),
        axis.text.y = element_blank()
        )

ggsave(filename = here(plots, 'hcpc', '20220321_animal_exposed-end_dend.png'), device = 'png', 
       height = 5, width = 7, units = 'in')

```

## MCA plots

```{r}
mca_animal_exposed_start$ggmca + 
  labs(title = 'Algae mca') +
    scale_color_manual(values = c('red','blue','purple', 'black',
                                  'green','orange', 'grey', 'yellow', 'brown',
                                  'grey17', 'pink', 'grey60', 'salmon',
                                  'violet', 'cornsilk2')) +
  theme_classic() +
  theme(legend.position = 'none')
  
  



  
ggsave(filename = here(plots, 'algaetest3.png'), device = 'png', 
       height = 5, width = 7, units = 'in')
```

```{r venns}
library(eulerr)

# make a list of lists
venn_all <- list(p_start = animal_sheltered_start$species,
                 p_end = animal_sheltered_end$species
                 #exposed = animal_exposed$species
                 )

# run eulerr
euleranimal <- euler(venn_all)

# plot output
plot(euleranimal,
     quantities = list(type = 'counts', cex = .75, fontface = 2),
     adjust_labels = TRUE,
     main = 'Unique fish species')
```
