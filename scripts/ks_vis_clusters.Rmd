---
title: "ks_cluster_visuals"
author: "Kate Sheridan"
date: "1/6/2022"
output: html_document
---
notes on reduction ; this should be done at an earlier stage
Algae (Laura’s thoughts):
Pared down list of traits for algae (7): species, common name division (brown, green, red), layer (turf, subcanopy, canopy), Steneck_Dethier morphology, body size, intertidal, subtidal
More pared down (5):  
species, common name division (brown, green, red), layer (turf, subcanopy, canopy), intertidal, subtidal

Animal (Laura’s thoughts):
More pared down for animals (6): 
species, common name division (fish, etc.), trophic level, adult motility, intertidal, subtidal




## copypasta from jenny

```{r setup, include=FALSE}

#libraries 

library(pacman)
pacman::p_load(dplyr, plyr, readr, tbible, FD, ade4, cowplot, mice, reshape2, tidyr, ks, hypervolume, alphallhu, purrr, TTR, plotrix, agricolae, psych)

library(factoextra)
library(ggrepel)
library(tibble)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(data.table)
library(extrafont)
library(visreg)
library(lubridate)
library(letsR)
library(reshape)
library(reshape2)
library(funrar)#to calculate functional uniqueness

library(Gifi)# to do PCA on categorical data
library(TPD)# 
library(FactoMineR)
#library(ts)

library(here)

loadfonts()
```



```{r}

#traits<-read.csv(here('data', "20210730_ShoalsFunctionalTraits.csv"),stringsAsFactors=FALSE) # the last version of the data


traits_algae_imputed<-read_csv(here('data','clean',"20210806_algae_imputed.csv"))
traits_algae_imputed <- traits_algae_imputed %>%
    dplyr::select(!('...1'))


traits_animal_imputed<-read_csv(here('data','clean',"20210806_animal_imputed.csv"))
traits_animal_imputed <- traits_animal_imputed %>%
    dplyr::select(!('...1'))


#Matrices

matrix_algae<-read.csv(here('data','clean',"20210806_algae_matrix.csv"))
matrix_algae <- as.matrix(matrix_algae)
matrix_animal<-read.csv(here('data','clean',"20210806_animal_matrix.csv"))
matrix_animal <- as.matrix(matrix_animal)


#Compared with the data from Gomez and from Cooke we have categorical and numerical data in out traits.
#One solution is to use Gifi package: Multivariate Analysis with Optimal Scaling
#Implements categorical principal component analysis ('PRINCALS'), multiple correspondence analysis ('HOMALS'), monotone regression analysis ('MORALS'). It replaces the 'homals' package.



### where is this ???
traits_modified_algae <- read_csv("traits_mod_algae.csv") #traits modified in algae converted to ordinal values as suggested in "gifi" package
traits_modified_animals<-read.csv("traits_modified_animals.csv")

```


# MCA

MCA with FactoMineR specifically is for categorical variables. 


## algae

This is just all of them, not specifically at a time point.

```{r}
algae_reduced <- traits_algae_imputed %>%
  dplyr::select(species, common_name_division_bgr, turf_subcanopy_canopy_algae,
         intertidal, subtidal) %>%
  column_to_rownames('species')


algae_mca <- MCA(algae_reduced)


#misc from vignette to test

plot.MCA(algae_mca)


dimdesc(algae_mca)

plotellipses(algae_mca)

```

## animals

```{r}
#traits_modified_animal_sel<-traits_modified_animals[,4:14] #select columns of interest
```


## package example

```{r}



###Example from the package to calculate PCA with categorical data
ABC
ABC6 <- ABC[,6:11]

fitord <- princals(ABC6) 

View (ABC6)

## ordinal PCA
fitord <- princals(ABC6,ndim =6)  ## ordinal PCA
fitord
summary(fitord)
plot(fitord, plot.type = "transplot")
plot(fitord, "loadplot", main = "Loadings Plot ABC Data")  ## aspect ratio = 1
plot(fitord, "biplot", labels.scores = TRUE, main = "Biplot ABC Data")
plot(fitord, "screeplot")



scoresfitord <- as.data.frame(fitord$scoremat) %>% 
  tibble::rownames_to_column("species")

## linear restrictions (mimics standard PCA)
abc_knots <- knotsGifi(ABC6, "E")     ## 0 interior knotsx
fitlin <- princals(ABC6, knots = abc_knots, degrees = 1)
fitlin
summary(fitlin)
fitlin$evals
plot(fitlin, plot.type = "transplot")
## compare with standard PCA
ABCnum <- makeNumeric(ABC6)
fitpca <- prcomp(ABCnum, scale = TRUE)
fitpca$sdev^2

summary(fitpca)
```


